<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reine Lindqvist's Musikquiz</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 30px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1DB954; /* Spotify Green */
            text-align: center;
            margin-bottom: 20px;
        }
        .quiz-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            justify-content: center;
            align-items: center;
        }
        select, button {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        button {
            background-color: #1DB954;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #17a447;
        }
        .quiz-output {
            padding: 20px;
            border: 2px solid #eee;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .error {
            color: #ff4d4d;
            font-weight: bold;
        }
        .success {
            color: #1DB954;
            font-weight: bold;
        }
        /* F√∂r att visualisera uppspelning */
        audio {
            width: 100%;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üéµ Musikquiz: V√§lj √Örtionde</h1>

        <div class="quiz-controls">
            <label for="decade-select">V√§lj √Örtionde:</label>
            <select id="decade-select">
                <option value="60s">60-talet</option>
                <option value="70s">70-talet</option>
                <option value="80s">80-talet</option>
                <option value="90s">90-talet</option>
                <option value="00s">2000-talet</option>
                <option value="10s">2010-talet</option>
                <option value="20s">2020-talet</option>
            </select>
            <button onclick="startNewRound()">Starta Runda</button>
        </div>

        <div id="quiz-output" class="quiz-output">
            <p>V√§lj ett √•rtionde och klicka p√• **Starta Runda** f√∂r att ladda en slumpm√§ssig l√•t.</p>
        </div>
    </div>

    <script>
        // *******************************************************************
        // KONTROLLPUNKT 1: ERS√ÑTT DENNA STR√ÑNG MED DIN FULLST√ÑNDIGA ACCESS TOKEN!
        // (Token √§r giltig i ca 1 timme)
        const SPOTIFY_ACCESS_TOKEN = "BQBOAEBL2E0h4s6-p5BckzcnSOEt53yp7lEaraTh_nYAHOAKQ_8f5oDUej39nCq92t8oy3OoWBW7gM12ZAfetE4ucKFCsnxe4GYIdS-4-3tI9oRmbmcrYXbDI_N...
"; 
        // *******************************************************************

        // 1. Spelliste-ID per √Örtionde (Spotify 'All Out' spellistor)
        const playlistSources = {
            '60s': '37i9dQZF1DXcKqP3JdK0pQ', // All Out 60s
            '70s': '37i9dQZF1DWTJg7XNnKFE3', // All Out 70s
            '80s': '37i9dQZF1DXcBWIGoYBM5M', // All Out 80s
            '90s': '37i9dQZF1DXbTjV1dE9zY7', // All Out 90s
            '00s': '37i9dQZF1DX4oNzlhCrbxM', // All Out 00s
            '10s': '37i9dQZF1DX5BAW6M0K4Vf', // All Out 10s
            '20s': '37i9dQZF1DXcBWIGoYBM5M', // Today's Top Hits (bra k√§lla f√∂r 20-talet)
        };
        
        // Vi h√§mtar 100 sp√•r f√∂r att √∂ka chansen att hitta minst 50 med preview_url
        const MAX_SONGS_TO_CHECK = 100; 
        
        async function startNewRound() {
            const selectElement = document.getElementById('decade-select');
            const selectedDecade = selectElement.value;
            const playlistId = playlistSources[selectedDecade];
            const outputElement = document.getElementById('quiz-output');

            if (SPOTIFY_ACCESS_TOKEN === "BQBOAEBL2E0h4s6-p5BckzcnSOEt53yp7lEaraTh_nYAHOAKQ_8f5oDUej39nCq92t8oy3OoWBW7gM12ZAfetE4ucKFCsnxe4GYIdS-4-3tI9oRmbmcrYXbDI_N...
" || SPOTIFY_ACCESS_TOKEN === "") {
                outputElement.innerHTML = `<p class="error">‚ùå FEL: V√§nligen klistra in din Spotify Access Token i koden.</p>`;
                return;
            }

            outputElement.innerHTML = `<p class="success">Laddar l√•tar fr√•n **${selectedDecade}** (Playlist ID: ${playlistId}). V√§nligen v√§nta...</p>`;

            try {
                // 2. RIKTIGT API-ANROP till Spotify
                const apiUrl = `https://api.spotify.com/v1/playlists/${playlistId}/tracks?limit=${MAX_SONGS_TO_CHECK}`;
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${SPOTIFY_ACCESS_TOKEN}` 
                    }
                });

                if (response.status === 401) {
                    throw new Error("Token utg√•ngen (401). Du m√•ste h√§mta en ny Access Token via PowerShell.");
                }
                if (!response.ok) {
                    throw new Error(`Spotify API-fel: ${response.status} ${response.statusText}.`);
                }

                const data = await response.json();
                const tracks = data.items.filter(item => item.track); 
                
                if (tracks.length === 0) {
                    outputElement.innerHTML = `<p class="error">Hittade inga sp√•r i spellistan.</p>`;
                    return;
                }
                
                // 3. Filtrera bort sp√•r som saknar f√∂rhandsvisning (preview_url)
                const tracksWithPreview = tracks.filter(item => item.track.preview_url !== null);

                if (tracksWithPreview.length === 0) {
                    outputElement.innerHTML = `
                        <p class="error">‚ùå Kunde inte hitta fler l√•tar fr√•n **${selectedDecade}** med f√∂rhandsvisning. F√∂rs√∂k ett nyare √•rtionde!</p>
                    `;
                    return;
                }

                // 4. V√§lj en Slumpm√§ssig L√•t
                const randomIndex = Math.floor(Math.random() * tracksWithPreview.length);
                const randomTrack = tracksWithPreview[randomIndex].track;

                // 5. Visa Resultat, Spela Upp Klippet
                const artistName = randomTrack.artists.map(a => a.name).join(', ');
                
                outputElement.innerHTML = `
                    <h2>üéâ Quiz-l√•t Laddad!</h2>
                    <p><strong>√Örtionde:</strong> ${selectedDecade}</p>
                    <p class="success"><strong>L√•t:</strong> ${randomTrack.name} av ${artistName}</p>
                    <hr>
                    <p>Spela upp klippet (ca 30 sekunder):</p>
                    <audio controls autoplay src="${randomTrack.preview_url}"></audio>
                `;
                
            } catch (error) {
                console.error("Fel vid laddning av l√•t:", error);
                outputElement.innerHTML = `<p class="error">üõë Ett allvarligt fel uppstod: ${error.message}.</p>`;
            }
        }
        
    </script>
</body>
</html>