<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gissa Artist och Ã…rtal - Musikquiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- PKCE (Proof Key for Code Exchange) HjÃ¤lpfunktioner ---
        // AnvÃ¤nds fÃ¶r att sÃ¤kert autentisera mot Spotify utan klienthemlighet
        function generateRandomString(length) {
            const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            // KRITISK FIX: Ã„ndrad frÃ¥n Uint8array till Uint8Array
            const values = crypto.getRandomValues(new Uint8Array(length));
            return values.reduce((acc, x) => acc + possible[x % possible.length], "");
        }

        async function sha256(plain) {
            const encoder = new TextEncoder()
            const data = encoder.encode(plain)
            return window.crypto.subtle.digest('SHA-256', data)
        }

        function base64urlencode(a) {
            // KRITISK FIX: Ã„ndrad frÃ¥n Uint8array till Uint8Array
            return btoa(String.fromCharCode.apply(null, new Uint8Array(a)))
                .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '')
        }

        async function generateCodeChallenge(v) {
            const hashed = await sha256(v)
            return base64urlencode(hashed);
        }
        // -----------------------------------------------------------------

        const MusicQuizGame = () => {
            const [gameState, setGameState] = useState('setup');
            const [players, setPlayers] = useState([]);
            const [currentPlayer, setCurrentPlayer] = useState(0);
            const [decade, setDecade] = useState('1980');
            const [currentSong, setCurrentSong] = useState(null);
            const [scores, setScores] = useState({});
            const [round, setRound] = useState(0);
            const [totalRounds] = useState(10);
            const [artistGuess, setArtistGuess] = useState('');
            const [yearGuess, setYearGuess] = useState('');
            const [showAnswer, setShowAnswer] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);
            const [audio, setAudio] = useState(null);
            const [spotifyConnected, setSpotifyConnected] = useState(false);
            const [spotifyToken, setSpotifyToken] = useState(null);
            const [usedSongs, setUsedSongs] = useState([]);

            const SPOTIFY_CLIENT_ID = 'f073bc8c44104091881e8c7bb49b7638';
            const SPOTIFY_REDIRECT_URI = 'https://reinel1969.github.io/MusikQuiz/musikquiz.html';
            const SPOTIFY_SCOPES = 'streaming user-read-email user-read-private';

            // getToken: Byter auktoriseringskoden mot en Access Token (Del av PKCE)
            const getToken = async (code, codeVerifier) => {
                const url = "https://accounts.spotify.com/api/token";
                
                const payload = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: SPOTIFY_REDIRECT_URI,
                        client_id: SPOTIFY_CLIENT_ID,
                        code_verifier: codeVerifier,
                    }),
                };
                
                try {
                    const response = await fetch(url, payload);
                    if (!response.ok) {
                        throw new Error(`Spotify token exchange error: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    setSpotifyToken(data.access_token);
                    setSpotifyConnected(true);
                    localStorage.setItem('spotify_token', data.access_token);
                    localStorage.removeItem('spotify_code_verifier');
                    
                } catch (error) {
                    console.error('Kunde inte byta kod mot token:', error);
                    alert('Ett fel uppstod vid anslutning till Spotify. FÃ¶rsÃ¶k igen.');
                }
            };


            // useEffect: Hanterar omdirigering frÃ¥n Spotify med auktoriseringskoden
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const savedToken = localStorage.getItem('spotify_token');

                if (code) {
                    const codeVerifier = localStorage.getItem('spotify_code_verifier');
                    
                    if (codeVerifier) {
                        getToken(code, codeVerifier);
                    }
                    // Rensar URL:en fÃ¶r att inte trigga om auktoriseringen vid omladdning
                    window.history.replaceState({}, document.title, window.location.pathname);

                } else if (savedToken) {
                    setSpotifyToken(savedToken);
                    setSpotifyConnected(true);
                }
            }, []);

            // connectSpotify: Startar PKCE-flÃ¶det genom att skicka anvÃ¤ndaren till Spotify
            const connectSpotify = async () => {
                // 1. Generera Code Verifier & Challenge
                const codeVerifier = generateRandomString(128);
                const codeChallenge = await generateCodeChallenge(codeVerifier);

                localStorage.setItem('spotify_code_verifier', codeVerifier);

                const params = new URLSearchParams({
                    response_type: 'code', // KORREKT: response_type fÃ¶r PKCE-flÃ¶det
                    client_id: SPOTIFY_CLIENT_ID,
                    scope: SPOTIFY_SCOPES,
                    redirect_uri: SPOTIFY_REDIRECT_URI,
                    code_challenge_method: 'S256',
                    code_challenge: codeChallenge,
                    show_dialog: true
                });

                // 2. Skicka anvÃ¤ndaren till Spotify
                const authUrl = `https://accounts.spotify.com/authorize?${params.toString()}`;
                window.location.href = authUrl;
            };

            const disconnectSpotify = () => {
                setSpotifyToken(null);
                setSpotifyConnected(false);
                localStorage.removeItem('spotify_token');
            };

            // searchSpotifySongs: MAXIMAL SÃ–KNINGSBRÃ„DD MED WILDCARD '*'
            const searchSpotifySongs = async (decadeStart) => {
                if (!spotifyToken) return null;

                const decadeEnd = parseInt(decadeStart) + 9;
                
                try {
                    // SÃ–KSTRÃ„NG: AnvÃ¤nder Wildcard * som sÃ¶kterm fÃ¶r att fÃ¥ bredaste mÃ¶jliga resultat inom Ã¥rtiondet
                    // Detta ersÃ¤tter all tidigare randomisering.
                    const response = await fetch(
                        `https://api.spotify.com/v1/search?q=$*%20year:${decadeStart}-${decadeEnd}&type=track&limit=50`,
                        {
                            headers: {
                                'Authorization': `Bearer ${spotifyToken}`
                            }
                        }
                    );

                    if (!response.ok) {
                        console.error('Spotify API error:', response.status);
                        if (response.status === 401) {
                            alert('Spotify-token har gÃ¥tt ut. Anslut igen!');
                            disconnectSpotify();
                        }
                        return null;
                    }

                    const data = await response.json();
                    
                    // Filtrerar bort lÃ¥tar utan preview_url och lÃ¥tar som redan anvÃ¤nts
                    const tracks = data.tracks.items.filter(track => 
                        track.preview_url && 
                        !usedSongs.includes(track.id) &&
                        track.album.release_date
                    );

                    if (tracks.length === 0) {
                        return null; // Kunde inte hitta oanvÃ¤nda lÃ¥tar med preview
                    }

                    const track = tracks[Math.floor(Math.random() * tracks.length)];
                    const releaseYear = parseInt(track.album.release_date.split('-')[0]);

                    return {
                        id: track.id,
                        artist: track.artists[0].name,
                        title: track.name,
                        year: releaseYear,
                        preview: track.preview_url,
                        albumCover: track.album.images[0]?.url
                    };
                } catch (error) {
                    console.error('Error fetching from Spotify:', error);
                    return null;
                }
            };

            const addPlayer = () => {
                if (players.length < 10) {
                    const newPlayer = `Spelare ${players.length + 1}`;
                    setPlayers([...players, newPlayer]);
                    setScores({...scores, [newPlayer]: 0});
                }
            };

            const removePlayer = (index) => {
                const newPlayers = players.filter((_, i) => i !== index);
                setPlayers(newPlayers);
                const newScores = {...scores};
                delete newScores[players[index]];
                setScores(newScores);
            };

            const updatePlayerName = (index, newName) => {
                const oldName = players[index];
                const newPlayers = [...players];
                newPlayers[index] = newName;
                setPlayers(newPlayers);
                
                const newScores = {...scores};
                newScores[newName] = newScores[oldName] || 0;
                delete newScores[oldName];
                setScores(newScores);
            };

            const startGame = async () => {
                if (players.length === 0) {
                    alert('LÃ¤gg till minst en spelare!');
                    return;
                }
                if (!spotifyConnected) {
                    alert('Anslut till Spotify fÃ¶rst!');
                    return;
                }
                setGameState('playing');
                setRound(1);
                setUsedSongs([]);
                await loadNewSong();
            };

            const loadNewSong = async () => {
                const song = await searchSpotifySongs(decade);
                
                if (!song) {
                    alert('Kunde inte hitta fler lÃ¥tar frÃ¥n detta Ã¥rtionde. FÃ¶rsÃ¶k ett annat! (Tips: Prova ett nyare Ã¥rtionde, t.ex. 2010-talet, som har fler fÃ¶rhandsvisningar.)');
                    return;
                }

                setCurrentSong(song);
                setUsedSongs([...usedSongs, song.id]);
                setArtistGuess('');
                setYearGuess('');
                setShowAnswer(false);
                setIsPlaying(false);
                
                if (audio) {
                    audio.pause();
                }
            };

            const togglePlay = () => {
                if (!currentSong?.preview) {
                    alert('Ingen fÃ¶rhandsvisning tillgÃ¤nglig fÃ¶r denna lÃ¥t');
                    return;
                }

                if (!audio) {
                    const newAudio = new Audio(currentSong.preview);
                    newAudio.play();
                    setAudio(newAudio);
                    setIsPlaying(true);
                    
                    newAudio.onended = () => {
                        setIsPlaying(false);
                    };
                } else {
                    if (isPlaying) {
                        audio.pause();
                        setIsPlaying(false);
                    } else {
                        audio.play();
                        setIsPlaying(true);
                    }
                }
            };

            const submitGuess = () => {
                if (!artistGuess || !yearGuess) {
                    alert('Fyll i bÃ¥de artist och Ã¥rtal!');
                    return;
                }

                let points = 0;
                const correctArtist = currentSong.artist.toLowerCase().trim();
                const guessedArtist = artistGuess.toLowerCase().trim();
                
                if (guessedArtist === correctArtist || 
                    correctArtist.includes(guessedArtist) ||
                    guessedArtist.includes(correctArtist)) {
                    points += 2;
                }
                
                if (parseInt(yearGuess) === currentSong.year) {
                    points += 1;
                }

                const newScores = {...scores};
                newScores[players[currentPlayer]] += points;
                setScores(newScores);
                setShowAnswer(true);

                if (audio) {
                    audio.pause();
                    setIsPlaying(false);
                }
            };

            const nextTurn = async () => {
                const nextPlayerIndex = (currentPlayer + 1) % players.length;
                setCurrentPlayer(nextPlayerIndex);
                
                if (nextPlayerIndex === 0) {
                    if (round >= totalRounds) {
                        setGameState('results');
                        if (audio) {
                            audio.pause();
                        }
                        return;
                    }
                    setRound(round + 1);
                }
                
                await loadNewSong();
            };

            const resetGame = () => {
                setGameState('setup');
                setRound(0);
                setCurrentPlayer(0);
                setUsedSongs([]);
                const resetScores = {};
                players.forEach(player => resetScores[player] = 0);
                setScores(resetScores);
                if (audio) {
                    audio.pause();
                    setAudio(null);
                }
            };

            const getSortedPlayers = () => {
                return [...players].sort((a, b) => scores[b] - scores[a]);
            };

            // Icons as SVG components
            const MusicIcon = () => (
                <svg className="w-16 h-16 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                </svg>
            );

            const TrophyIcon = () => (
                <svg className="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            );

            const PlayIcon = () => (
                <svg fill="currentColor" viewBox="0 0 24 24" width="32" height="32">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            );

            const PauseIcon = () => (
                <svg fill="currentColor" viewBox="0 0 24 24" width="32" height="32">
                    <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                </svg>
            );

            const SkipForwardIcon = () => (
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                </svg>
            );

            if (gameState === 'setup') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-600 to-red-600 p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                <div className="flex items-center justify-center mb-8">
                                    <MusicIcon />
                                    <h1 className="text-4xl font-bold text-gray-800 ml-4">Gissa Artist & Ã…rtal</h1>
                                </div>

                                <div className="mb-8 p-6 bg-green-50 rounded-xl border-2 border-green-200">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className={`w-4 h-4 rounded-full mr-3 ${spotifyConnected ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                            <span className="text-lg font-semibold text-gray-700">
                                                {spotifyConnected ? 'Ansluten till Spotify âœ“' : 'Ej ansluten till Spotify'}
                                            </span>
                                        </div>
                                        {spotifyConnected ? (
                                            <button
                                                onClick={disconnectSpotify}
                                                className="bg-red-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-600"
                                            >
                                                Koppla frÃ¥n
                                            </button>
                                        ) : (
                                            <button
                                                onClick={connectSpotify}
                                                className="bg-green-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-600"
                                            >
                                                Anslut Spotify
                                            </button>
                                        )}
                                    </div>
                                    {!spotifyConnected && (
                                        <p className="text-sm text-gray-600 mt-3">
                                            Klicka pÃ¥ "Anslut Spotify" fÃ¶r att logga in med ditt Spotify-konto
                                        </p>
                                    )}
                                </div>

                                <div className="mb-8">
                                    <h2 className="text-2xl font-semibold mb-4 text-gray-700">VÃ¤lj Ã¥rtionde</h2>
                                    <div className="grid grid-cols-5 gap-4">
                                        {['1970', '1980', '1990', '2000', '2010'].map(dec => (
                                            <button
                                                key={dec}
                                                onClick={() => setDecade(dec)}
                                                className={`p-4 rounded-xl font-semibold transition-all ${
                                                    decade === dec
                                                        ? 'bg-purple-600 text-white scale-105'
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {dec}-talet
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-8">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-semibold text-gray-700">Spelare ({players.length}/10)</h2>
                                        <button
                                            onClick={addPlayer}
                                            disabled={players.length >= 10}
                                            className="bg-green-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-600 disabled:bg-gray-300"
                                        >
                                            + LÃ¤gg till spelare
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        {players.map((player, index) => (
                                            <div key={index} className="flex items-center justify-between bg-gray-100 p-4 rounded-lg">
                                                <input
                                                    type="text"
                                                    value={player}
                                                    onChange={(e) => updatePlayerName(index, e.target.value)}
                                                    className="font-semibold text-gray-700 bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-purple-600 rounded px-2"
                                                />
                                                <button
                                                    onClick={() => removePlayer(index)}
                                                    className="bg-red-500 text-white px-4 py-1 rounded hover:bg-red-600"
                                                >
                                                    Ta bort
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button
                                    onClick={startGame}
                                    disabled={players.length === 0 || !spotifyConnected}
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-xl font-bold hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-400 transition-all"
                                >
                                    Starta spelet!
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'playing' && currentSong) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-600 to-red-600 p-8">
                        <div className="max-w-6xl mx-auto">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2 bg-white rounded-3xl shadow-2xl p-8">
                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-3xl font-bold text-gray-800">
                                                Runda {round}/{totalRounds}
                                            </h2>
                                            <span className="text-xl font-semibold text-purple-600">
                                                {decade}-talet
                                            </span>
                                        </div>
                                        <div className="bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-xl">
                                            <p className="text-lg font-semibold text-gray-700">
                                                Nu spelar: <span className="text-purple-600">{players[currentPlayer]}</span>
                                            </p>
                                        </div>
                                    </div>

                                    <div className="mb-8">
                                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 text-white mb-6">
                                            {currentSong.albumCover && (
                                                <div className="mb-4 flex justify-center">
                                                    <div className="w-48 h-48 bg-gray-700 rounded-lg overflow-hidden" style={{filter: 'blur(8px)'}}>
                                                        <img src={currentSong.albumCover} alt="Album cover" className="w-full h-full object-cover" />
                                                    </div>
                                                </div>
                                            )}
                                            <h3 className="text-2xl font-bold mb-4 text-center">ðŸŽµ Lyssna pÃ¥ lÃ¥ten</h3>
                                            <div className="flex justify-center space-x-4">
                                                <button
                                                    onClick={togglePlay}
                                                    className="bg-white text-gray-900 p-4 rounded-full hover:bg-gray-200 transition-all"
                                                >
                                                    {isPlaying ? <PauseIcon /> : <PlayIcon />}
                                                </button>
                                            </div>
                                            <p className="text-center mt-4 text-gray-400 text-sm">
                                                30 sekunders fÃ¶rhandsvisning frÃ¥n Spotify
                                            </p>
                                        </div>

                                        {!showAnswer ? (
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-gray-700 font-semibold mb-2">Artist</label>
                                                    <input
                                                        type="text"
                                                        value={artistGuess}
                                                        onChange={(e) => setArtistGuess(e.target.value)}
                                                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                                        placeholder="Skriv artistens namn..."
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-700 font-semibold mb-2">Ã…rtal</label>
                                                    <input
                                                        type="number"
                                                        value={yearGuess}
                                                        onChange={(e) => setYearGuess(e.target.value)}
                                                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                                        placeholder="Skriv Ã¥rtal..."
                                                    />
                                                </div>
                                                <button
                                                    onClick={submitGuess}
                                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:from-purple-700 hover:to-pink-700 transition-all"
                                                >
                                                    Skicka svar
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                <div className="bg-green-100 border-2 border-green-500 rounded-xl p-6">
                                                    <h4 className="text-xl font-bold text-green-800 mb-3">RÃ¤tt svar:</h4>
                                                    <p className="text-lg"><strong>LÃ¥t:</strong> {currentSong.title}</p>
                                                    <p className="text-lg"><strong>Artist:</strong> {currentSong.artist}</p>
                                                    <p className="text-lg"><strong>Ã…rtal:</strong> {currentSong.year}</p>
                                                    <p className="text-lg mt-3"><strong>Ditt svar:</strong></p>
                                                    <p>Artist: {artistGuess} {artistGuess.toLowerCase().trim() === currentSong.artist.toLowerCase().trim() ? 'âœ“' : 'âœ—'}</p>
                                                    <p>Ã…rtal: {yearGuess} {parseInt(yearGuess) === currentSong.year ? 'âœ“' : 'âœ—'}</p>
                                                </div>
                                                <button
                                                    onClick={nextTurn}
                                                    className="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all flex items-center justify-center"
                                                >
                                                    NÃ¤sta <span className="ml-2"><SkipForwardIcon /></span>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-white rounded-3xl shadow-2xl p-6">
                                    <div className="flex items-center mb-6">
                                        <TrophyIcon />
                                        <h3 className="text-2xl font-bold text-gray-800 ml-3">PoÃ¤ngstÃ¤llning</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {getSortedPlayers().map((player, index) => (
                                            <div
                                                key={player}
                                                className={`p-4 rounded-xl ${
                                                    player === players[currentPlayer]
                                                        ? 'bg-purple-100 border-2 border-purple-600'
                                                        : 'bg-gray-100'
                                                }`}
                                            >
                                                <div className="flex justify-between items-center">
                                                    <div className="flex items-center">
                                                        <span className="text-2xl mr-3">
                                                            {index === 0 ? 'ðŸ¥‡' : index === 1 ? 'ðŸ¥ˆ' : index === 2 ? 'ðŸ¥‰' : ''}
                                                        </span>
                                                        <span className="font-semibold text-gray-700">{player}</span>
                                                    </div>
                                                    <span className="text-xl font-bold text-purple-600">
                                                        {scores[player]} p
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="mt-6 p-4 bg-blue-50 rounded-xl">
                                        <p className="text-sm text-gray-600">
                                            <strong>PoÃ¤ngsystem:</strong><br />
                                            RÃ¤tt artist: 2p<br />
                                            RÃ¤tt Ã¥rtal: 1p
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'results') {
                const winner = getSortedPlayers()[0];
                return (
                    <div className="min-h-screen bg-gradient-to-br from-yellow-400 via-orange-500 to-red-600 p-8 flex items-center justify-center">
                        <div className="bg-white rounded-3xl shadow-2xl p-12 max-w-2xl w-full">
                            <div className="text-center mb-8">
                                <div className="w-24 h-24 mx-auto mb-4">
                                    <TrophyIcon />
                                </div>
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">Spelet Ã¤r slut!</h1>
                                <p className="text-2xl text-gray-600">Vinnare: <span className="text-yellow-600 font-bold">{winner}</span></p>
                            </div>

                            <div className="space-y-4 mb-8">
                                {getSortedPlayers().map((player, index) => (
                                    <div
                                        key={player}
                                        className="flex justify-between items-center p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl"
                                    >
                                        <div className="flex items-center">
                                            <span className="text-3xl mr-4">
                                                {index === 0 ? 'ðŸ¥‡' : index === 1 ? 'ðŸ¥ˆ' : index === 2 ? 'ðŸ¥‰' : `${index + 1}.`}
                                            </span>
                                            <span className="text-xl font-semibold text-gray-700">{player}</span>
                                        </div>
                                        <span className="text-2xl font-bold text-purple-600">{scores[player]} poÃ¤ng</span>
                                    </div>
                                ))}
                            </div>

                            <button
                                onClick={resetGame}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-xl font-bold hover:from-purple-700 hover:to-pink-700 transition-all"
                            >
                                Spela igen
                            </button>
                        </div>
                    </div>
                );
            }
        };

        ReactDOM.render(<MusicQuizGame />, document.getElementById('root'));
    </script>
</body>
</html>